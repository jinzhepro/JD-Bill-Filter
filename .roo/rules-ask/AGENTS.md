# AGENTS.md

This file provides guidance to agents when working with code in this repository.

## 项目文档规则（非显而易见部分）

### 业务逻辑说明

- **系统专门处理京东万商对帐单，数据结构包含特定字段：订单编号、单据类型、费用项、商品编号等** - 业务特定数据结构
- **"合流共配回收运费"费用项需要特殊处理，会替换对应商品的货款金额** - 业务特定逻辑，非标准处理
- **只有"订单"和"取消退款单"类型的单据会被处理，其他类型会被过滤** - 业务规则，不是通用逻辑
- **最终输出只包含：商品名称、商品编号、单价、商品数量、总价五个字段** - 输出格式固定，不可更改

### 文件处理说明

- **CSV 文件编码自动检测逻辑：先尝试 UTF-8，如果检测不到中文字符则切换 GBK** - 处理中文编码的特殊逻辑
- **Excel 导出时商品编码列强制设置为文本格式，防止长数字变成科学计数法** - 避免数据格式问题的特殊处理
- **文件大小限制 50MB 是基于浏览器内存处理能力考虑** - 非任意限制，有技术原因
- **多文件合并功能要求至少 2 个文件才能启用** - UI 交互逻辑，不是技术限制

### 状态管理说明

- **AppContext 使用 useReducer 而不是多个 useState，确保状态更新的原子性** - 状态管理架构决策
- **mergeMode 状态控制整个多文件合并流程的 UI 展示** - 状态与 UI 的耦合关系
- **fileDataArray 存储每个文件的原始数据，用于合并处理** - 数据存储策略
- **所有 action 都通过 useCallback 包装，避免子组件不必要的重渲染** - 性能优化策略

### 组件交互说明

- **AppContent 组件根据状态动态渲染不同的上传组件和处理组件** - 组件条件渲染逻辑
- **Modal 组件会自动处理 body 的 overflow 样式，防止背景滚动** - 副作用处理，容易被忽略
- **Button 组件使用 React.memo 优化，避免父组件重渲染时影响按钮性能** - 性能优化细节
- **表格组件使用固定表头和自定义滚动条，提升大数据量展示体验** - 用户体验优化

### 数据处理流程说明

- **订单数据先按订单编号分组，再按商品编号分组** - 数据处理的核心算法
- **金额计算使用 Decimal.js 确保精度，避免浮点数运算误差** - 精度处理的关键决策
- **合并相同 SKU 和单价的记录时，会累加数量和总金额** - 数据合并逻辑
- **处理过程中会过滤掉总价为 0 或未定义的无效记录** - 数据清洗规则
