# 数据库连接权限问题解决方案

## 问题描述

错误信息：`Access denied for user 'root'@'39.77.26.135' (using password: YES)`
错误代码：`ER_ACCESS_DENIED_ERROR` (1045)

## 当前连接配置

- 主机：117.73.22.92
- 端口：3306
- 用户：root
- 数据库：jdws
- 客户端 IP：39.77.26.135

## 可能的解决方案

### 方案 1：在 MySQL 服务器上为 root 用户授权远程访问

在 MySQL 服务器上执行以下 SQL 命令：

```sql
-- 授予root用户从任何IP地址访问的权限
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'Qyt0532$2023';

-- 或者只授予特定IP地址的权限
GRANT ALL PRIVILEGES ON *.* TO 'root'@'39.77.26.135' IDENTIFIED BY 'Qyt0532$2023';

-- 刷新权限
FLUSH PRIVILEGES;
```

### 方案 2：创建新的数据库用户

```sql
-- 创建新用户
CREATE USER 'jdws_user'@'%' IDENTIFIED BY 'Qyt0532$2023';

-- 或者只允许特定IP
CREATE USER 'jdws_user'@'39.77.26.135' IDENTIFIED BY 'Qyt0532$2023';

-- 授予权限
GRANT ALL PRIVILEGES ON jdws.* TO 'jdws_user'@'%';

-- 刷新权限
FLUSH PRIVILEGES;
```

如果使用新用户，需要更新 `.env.local` 文件：

```
DB_USER=jdws_user
```

### 方案 3：检查 MySQL 服务器配置

1. 检查 MySQL 配置文件 (`/etc/mysql/mysql.conf.d/mysqld.cnf` 或 `/etc/my.cnf`)：

   ```
   # 注释掉或修改bind-address
   # bind-address = 127.0.0.1
   bind-address = 0.0.0.0
   ```

2. 重启 MySQL 服务：
   ```bash
   sudo systemctl restart mysql
   # 或者
   sudo service mysql restart
   ```

### 方案 4：检查防火墙设置

确保 MySQL 端口（3306）在服务器防火墙中开放：

```bash
# Ubuntu/Debian
sudo ufw allow 3306

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=3306/tcp
sudo firewall-cmd --reload
```

### 方案 5：验证用户密码

确认密码是否正确，可以在 MySQL 服务器上执行：

```sql
SELECT User, Host FROM mysql.user WHERE User = 'root';
```

## 推荐步骤

1. 首先尝试方案 1，为 root 用户授予远程访问权限
2. 如果方案 1 不工作，尝试方案 2 创建新用户
3. 检查 MySQL 服务器配置和防火墙设置
4. 如果问题仍然存在，联系数据库管理员

## 测试连接

在应用中测试连接：

```bash
curl -X POST http://localhost:3000/api/mysql \
  -H "Content-Type: application/json" \
  -d '{"action":"testConnection"}'
```

## 安全注意事项

- 生产环境中不建议使用 root 用户进行应用连接
- 建议创建专用的数据库用户，只授予必要的权限
- 使用强密码
- 考虑使用 SSL 连接加密数据传输
