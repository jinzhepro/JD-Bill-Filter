# AGENTS.md

This file provides guidance to agents when working with code in this repository.

## 项目编码规则（非显而易见部分）

### 数据处理规范

- **处理金额时必须使用 Decimal.js** - 避免浮点数精度问题，所有金额运算必须通过 Decimal 对象
- **订单数据必须按"订单编号"分组处理** - 使用 mergeGroup 函数，这是业务逻辑的核心
- **合并记录时必须同时检查商品编号和单价** - 确保数据准确性，避免错误合并
- **CSV 文件读取需要先尝试 UTF-8，失败后自动切换到 GBK 编码** - 处理中文编码问题
- **"合流共配回收运费"特殊处理逻辑** - 会替换对应商品的货款金额，需要在 groupedData 生成后处理

### 文件处理规范

- **Excel 导出时必须设置商品编码列为文本格式** - 避免长数字变成科学计数法
- **文件大小限制为 50MB，超出时必须抛出明确错误** - 基于浏览器内存处理能力考虑
- **支持的文件类型：.xlsx, .xls, .csv，必须严格验证** - 防止恶意文件上传
- **文件读取使用 Promise 包装** - 确保异步操作正确处理

### 状态管理规范

- **全局状态必须通过 AppContext 管理** - 避免直接修改状态
- **使用 useReducer 处理复杂状态逻辑，action 类型必须定义在 ActionTypes 对象中** - 确保状态变更可预测
- **所有状态更新操作必须使用 useCallback 包装** - 避免不必要的重渲染
- **错误状态必须通过 setError 统一管理** - 确保用户界面一致性

### 组件开发规范

- **所有客户端组件必须以 "use client"; 开头** - Next.js 13+ 要求
- **使用 React.memo 优化性能，特别是 Button 等基础组件** - 避免父组件重渲染时影响按钮性能
- **Modal 组件必须处理 body 样式，防止背景滚动** - 组件卸载时必须清理样式
- **文件上传组件必须同时支持拖拽和点击上传** - 用户体验要求

### 导入路径规范

- **项目内部导入必须使用 @/ 别名指向 src/ 目录** - 统一路径管理
- **组件导入顺序：React → 第三方库 → 项目内部 → 相对路径** - 代码可读性要求
- **工具函数导入必须明确指定函数名，避免使用默认导出** - 防止 tree-shaking 问题

### 错误处理规范

- **所有异步操作必须使用 try-catch 包装** - 确保错误不会静默失败
- **错误信息必须用户友好，避免技术术语** - 提升用户体验
- **文件处理错误必须包含文件名和具体原因** - 便于调试
- **数据验证错误必须指出缺失的字段名称** - 用户友好提示

### Toast 提示系统规范

- **必须使用统一的 useToast hook，不允许使用其他 toast 库** - 确保界面一致性
- **Toast 调用格式：toast({ title: "消息" }) 用于成功，toast({ variant: "destructive", title: "错误" }) 用于错误** - 项目标准化格式
- **所有关键操作都需要添加用户反馈提示** - 提升用户体验
